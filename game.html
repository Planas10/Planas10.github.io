<html>
	<head>
		<title>Pagina de la asignatura de lenguaje de marcas</title>
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Ubuntu+Condensed&family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">
	
		<link rel="stylesheet" href="base.css" />
		<link rel="stylesheet" href="game.css" />
	
		<script>
			
			fetch("https://planas10.github.io/game.json").then(response => response.json()).then(data => game(data));
	
			let game_data;
	
			let current_room = 0;
			let items_picked = [];
	
			function game (data)
			{
				game_data = data
	
				document.getElementById("terminal").innerHTML = "<p><strong>¡Bienvenidos a ENTIerrame!</strong>El juego de terror definitivo.</p>";
				document.getElementById("terminal").innerHTML += "<p>Te encuentras en "+game_data.rooms[current_room].name+". ¿Qué quieres hacer?</p>";
	
				console.log(data.rooms[0].name);
			}

			function terminal_out (info)
			{
				let terminal = document.getElementById("terminal");
			
				terminal.innerHTML += info;
			
				terminal.scrollTop = terminal.scrollHeight;
			}

			function parseCommand(command){
				console.log("El comando ", command);
				switch (command){
					case "ver":
						terminal_out("<p>"+game_data.rooms[current_room].description+"</p>");
						break;

					case "ir":
						let doors = "";
						let doors_num = game_data.rooms[current_room].doors.length;
						for (let i = 0; i < doors_num; i++){
							doors += game_data.rooms[current_room].doors[i]+" ";
						}
						terminal_out("<p>Puedes ir a: "+doors+"</p>");
						break;

					default:
						terminal_out("<p><strong>Error</strong>: "+command+" commando no encontrado</p>");
				}
			}

			function getRoomNumber (room)
			{
				for (let i = 0; i < game_data.room.length; i++)
				{
					if (game_data.rooms[i].id == room)
					{
						return -1;
					}
				}
			}

			function getDoorNumber (door)
			{
				for (let i = 0; i < game_data.doors.length; i++)
				{
					if (game_data.doors[i].id == door)
					{
						return -1;
					}
				}
			}


			function parseInstruction (instruction)
			{
			
				console.log("La instrucción ", instruction);
			
				switch (instruction[0]){
					case "ver":
			
						break;
			
					case "ir":
						
						let door_num = getDoorNumber(instruction[1]);
						if (door_num < 0){
							console.log("Puerta erronea");
							return;
						}
			
						let room_num = getRoomNumber(game_data.doors[door_num].rooms[0]);
						if (room_num == current_room){
							current_room = getRoomNumber(game_data.doors[door_num].rooms[1]);
						}
						else{
							current_room = room_num;
						}
			
						break;
			
					case "coger":
			
						break;
			
			
					default:
						terminal_out("<p><strong>Error</strong>: "+instruction[0]+" commando no encontrado</p>");
				}
			}



			function readAction()
			{
					let instruction = document.getElementById("commands").value;
					let instruction_trim = instruction.trim();

					let data = instruction_trim.split(" ");

					if (data.length == 0 || instruction_trim == ""){
						document.getElementById("terminal").innerHTML += "<p><strong>Error</strong>: escribe un comando valido</p>";
						return;
					}

					if (data.length == 1){
						parseCommand(data[0]);
					}
					else{
						parseInstruction(data);
					}
			}

	

		</script>
	</head>
	<body>
		<header>
			<h1>Marc Planas, pagina de ENTI (M04UF1)</h1>
			<nav>
				<ul>
					<li id="menu-presentaTión"><a href="index.html">Presentación</a></li>
					<li id="menu-hobbies"><a href="hobbies.html">hobbies</a></li>
					<li id="menu-contact"><a href="contact.html">contacto</a></li>
					<li id="menu-cv"><a href="cv.html">CV</a></li>
	
				</ul>
			</nav>
		</header>
		<main>
			<article>
				<h2>Juegaco</h2>
				<form id="game-form">
					<div id="terminal"></div>
					<input type="text" id="commands" />
					<input type="submit" value="Acción" onclick="readAction(); return false;" />
				</form>
			</article>
			<aside>
				<h2>Lateral</h2>
				<p>Ejemplo de menú lateral</p>
			</aside>
		</main>
		<footer>
			<p id="kopyderecha">Kopyderecha(K) <span id="footer-year">2022</span> - Marc Planas Mas</p>
			<script>
				document.getElementById("footer-year").innerHTML = new Date().getFullYear();

			</script>
		</footer>
	</body>
</html>